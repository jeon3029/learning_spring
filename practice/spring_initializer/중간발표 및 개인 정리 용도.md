# 중간발표 및 개인 정리 용도

## 개요

- 전반적인 흐름
  - 서블릿 개념
  - 기본적인 웹 서버 어플리케이션
  - HttpServletRequest, HttpServletResponse 활용
- 스프링 MVC 이전의 문법 및 MVC 패턴이 나타나게된 원리(불편한 점)
  - 리팩토링하면서 과정을 이해

### 서블릿 개념

![img1](./img/servlet.png)

- 웹서버에서 동작하는 서비스 페이지로, 웹 브라우저에서 클라이언트의 요청에 따라 서버가 실행하는 자바 프로그램

1. 사용자 요청
   - 사용자가 웹서버에 요청 전달
   - 서블릿 요청일 경우 was 에 전달

2. WebContainer 에서 request, response 객체 생성
   - HttpServletRequest, HttpServletResponse 객체 생성

3. 사용자 요청 처리
   - WebContainer 에서 url 이 어떤 servlet 에 매핑되는지 찾음
   - 이전에 요청된 적 없다면 객체 생성, 해당 servlet의 init() 를 호출하고 메모리에 로드
     - 생성한 적 있다면 객체를 다시 생성하지 않음
   - 사용자 요청을 처리할 Thread 생성
   - 해당 Servlet 의 service() 메소드 실행
   - 사용자 요청에 따라 doGet(), doPost() 메소드 실행.
     - 앞서 생성한 HttpServletRequest, HttpServletResponse를 통해서 인수로 전달받음
4. 응답
   - response객체를 Webcontainer에서 HttpResponse로 바꾸어 Webserver에 전송
5. 소멸
   - request, response 객체 소멸
   - Thread 를 종료

### 기본적인 웹 서버 어플리케이션

- 코드
  - [ServletApplication](./servlet/src/main/java/hello/servlet/Application.java)
  - [HelloServler](./servlet/src/main/java/hello/servlet/basic/HelloServlet.java)
- 실행
  - http://localhost:8080/hello?username=world

- 시스템 출력 로그
  - application.properties 수정
  `logging.level.org.apache.coyote.http11=debug`

### 페이지를 띄우려면?

- http://localhost:8080 에 뜨는 화면
- 코드
  - [index.html](./servlet/src/main/webapp/index.html)
- 추가 구현
  - [basic.html](./servlet/src/main/webapp/basic.html)

### 데이터 주고받기 : HttpServletRequest, HttpServletResponse

#### HttpHeader

- Http 요청 메세지
  - Start Line
    - HttpMethod
    - Url
    - 쿼리스트링
    - 스키마, 프로토콜
  - 헤더
    - 헤더조회
  - 바디
    - form 파리미터 조회
    - message body 조회

```text
  POST /save HTTP/1.1
  Host: localhost:8080
  Content-Type: application/x-www-form-urlencoded
  username=kim&age=20
```

- 부가 기능
  - 임시저장소 기능
    - request.setAttribute(name,value)
    - request.getAttribute(name)
  - 세션 관리 기능
    - request.getSession(create:true)

- 코드
  - [RequestHeaderServlet](./servlet/src/main/java/hello/servlet/basic/request/RequestHeaderServlet.java)
  - http://localhost:8080/basic.html 에서 header 조회메뉴

#### HttpRequest Data

- 데이터 형식
  - GET
    - 쿼리 파라미터
    - /url?username=hello&age=20
    - 코드
      - [HttpParamServlet](./servlet/src/main/java/hello/servlet/basic/request/RequestParamServlet.java)
      - http://localhost:8080/request-param?username=hello&age=20
  - POST
    - content-type: application x-www-form-urlencoded
    - 메시지 바디에 쿼리 파리미터 형식으로 전달 username=hello&age=20
    - [hello-form](./servlet/src/main/webapp/basic/hello-form.html)
    - http://localhost:8080/basic/hello-form.html
    - application/x-www-form-urlencoded 형식은 앞서 GET에서 살펴본 쿼리 파라미터 형식과 같다. 따라서 쿼리 파라미터 조회 메서드를 그대로 사용하면 된다.
  - Http message body
    - HTTP API에서 주로 사용, JSON, XML, TEXT